# Output Files Reference

This document describes all output files generated by the VCA Pipeline.

---

## Directory Structure

```text
results/
├── aligned/                    # Alignment files
├── coverage/                   # Coverage statistics
├── fastp/                      # Trimming reports
├── fastqc/                     # Raw read QC reports
├── multiqc/                    # Aggregated QC report
├── pipeline_info/              # Execution reports
├── reference/                  # Reference genome indexes
├── results/                    # Final variant summaries
├── snpeff/                     # Annotation reports
├── stats/                      # Alignment and variant statistics
└── variants/                   # VCF files
```

---

## Alignment Files (`aligned/`)

| File | Description |
|------|-------------|
| `{sample}.sorted.bam` | Coordinate-sorted BAM file |
| `{sample}.markdup.bam` | Deduplicated BAM file |
| `{sample}.bai` | BAM index file |

**Format**: BAM (Binary Alignment Map)

**Usage**:

```bash
# View alignments
samtools view -h results/aligned/sample1.markdup.bam | less

# Check alignment stats
samtools flagstat results/aligned/sample1.markdup.bam
```

---

## Coverage Statistics (`coverage/`)

| File | Description |
|------|-------------|
| `{sample}.mosdepth.summary.txt` | Per-chromosome coverage summary |
| `{sample}.mosdepth.global.dist.txt` | Cumulative coverage distribution |
| `{sample}.per-base.bed.gz` | Per-base coverage (if enabled) |
| `{sample}.regions.bed.gz` | Per-region coverage (if BED provided) |

**Format**: TSV/BED

**Example `mosdepth.summary.txt`**:

```text
chrom    length      bases       mean    min     max
chr12    133275309   2665506180  20.0    0       1523
total    133275309   2665506180  20.0    0       1523
```

---

## Quality Control (`fastqc/`, `fastp/`)

### FastQC

| File | Description |
|------|-------------|
| `{sample}_1_fastqc.html` | Interactive HTML report for R1 |
| `{sample}_2_fastqc.html` | Interactive HTML report for R2 |
| `zips/{sample}_*.zip` | Raw FastQC data |

### fastp

| File | Description |
|------|-------------|
| `{sample}.fastp.json` | Machine-readable trimming statistics |
| `{sample}.fastp.html` | Interactive HTML trimming report |

**Key metrics in fastp JSON**:

- `summary.before_filtering.total_reads`
- `summary.after_filtering.total_reads`
- `filtering_result.passed_filter_reads`
- `adapter_cutting.adapter_trimmed_reads`

---

## Variant Files (`variants/`)

| File | Description |
|------|-------------|
| `{sample}.lofreq.vcf.gz` | Raw LoFreq variant calls |
| `{sample}.lofreq.vcf.gz.tbi` | VCF index |
| `{sample}.norm.vcf.gz` | Normalized variants (left-aligned) |
| `{sample}.ann.vcf.gz` | SnpEff annotated variants |
| `{sample}.somatic.vcf.gz` | Germline-filtered variants (if enabled) |

**Format**: VCF (Variant Call Format), bgzip compressed

**Example variant record**:

```text
chr12   25398284    .   C   T   253.0   PASS    DP=1523;AF=0.0328;SB=0;DP4=734,739,25,25
```

**Key INFO fields**:

- `DP`: Total read depth
- `AF`: Variant allele frequency
- `SB`: Strand bias score
- `DP4`: Ref-forward, ref-reverse, alt-forward, alt-reverse counts

---

## Annotation Reports (`snpeff/`)

| File | Description |
|------|-------------|
| `{sample}.snpeff_stats.csv` | Per-variant effect statistics |
| `{sample}.snpeff_summary.html` | Interactive annotation summary |
| `snpEff_genes.txt` | Per-gene impact summary |

**Effect categories**:

- HIGH: Frameshift, stop gained, splice site
- MODERATE: Missense, in-frame indel
- LOW: Synonymous, splice region
- MODIFIER: Intron, UTR, intergenic

---

## Statistics (`stats/`)

| File | Description |
|------|-------------|
| `{sample}.flagstat.txt` | samtools flagstat output |
| `{sample}.insert_size_metrics.txt` | Picard insert size statistics |
| `{sample}.insert_size_histogram.pdf` | Insert size distribution plot |
| `{sample}.bcftools_stats.txt` | Variant call statistics |
| `{sample}.lofreq_stats.txt` | LoFreq calling statistics |

**Key metrics in flagstat**:

```text
1523456 + 0 in total (QC-passed reads + QC-failed reads)
1520000 + 0 primary mapped (99.77% : N/A)
```

---

## Final Results (`results/`)

| File | Description |
|------|-------------|
| `all_variants.csv` | All variants from all samples |
| `candidate_variants.csv` | High-confidence candidate biomarkers |
| `summary_stats.csv` | Per-sample variant summary |

### `all_variants.csv` Columns

| Column | Description |
|--------|-------------|
| `sample` | Sample identifier |
| `patient_id` | Patient identifier |
| `timepoint` | Sample timepoint |
| `chrom` | Chromosome |
| `pos` | Position (1-based) |
| `ref` | Reference allele |
| `alt` | Alternate allele |
| `af` | Variant allele frequency |
| `dp` | Read depth |
| `gene` | Gene symbol |
| `effect` | Variant effect (from SnpEff) |
| `impact` | Effect impact (HIGH/MODERATE/LOW/MODIFIER) |
| `hgvs_p` | Protein change (HGVS notation) |
| `hgvs_c` | Coding change (HGVS notation) |

### `candidate_variants.csv`

Filtered subset of `all_variants.csv` containing:

- VAF ≥ 1% (configurable)
- Impact = HIGH or MODERATE
- Located in target gene

---

## MultiQC Report (`multiqc/`)

| File | Description |
|------|-------------|
| `multiqc_report.html` | Interactive aggregate QC report |
| `multiqc_data/` | Raw data for each module |

**Included modules**:

- FastQC
- fastp
- Samtools (flagstat)
- Picard (insert size)
- mosdepth (coverage)
- bcftools (stats)
- SnpEff

---

## Pipeline Reports (`pipeline_info/`)

| File | Description |
|------|-------------|
| `execution_report.html` | Nextflow execution summary |
| `execution_timeline.html` | Process timeline visualization |
| `execution_trace.txt` | Per-process resource usage |
| `pipeline_dag.svg` | Workflow DAG visualization |

**Key metrics in trace file**:

- `realtime`: Actual wall-clock time
- `%cpu`: CPU utilization
- `peak_rss`: Maximum memory used
- `peak_vmem`: Maximum virtual memory

---

## Reference Files (`reference/`)

| File | Description |
|------|-------------|
| `*.fa.fai` | FASTA index |
| `bwa_index/` | BWA index files (if generated) |

---

## File Size Estimates

| Output Type | Size per Sample |
|-------------|-----------------|
| BAM files | 2-10 GB (depends on coverage) |
| VCF files | 1-50 MB |
| QC reports | 5-20 MB |
| Coverage files | 10-100 MB |
| **Total** | **2-15 GB per sample** |

---

## Accessing Results

### Copy to Local Machine

```bash
# From HPC
scp -r user@cluster:/path/to/results ./local_results/

# Specific files only
scp user@cluster:/path/to/results/variants/*.vcf.gz ./
```

### View VCF in IGV

1. Transfer VCF and BAM files
2. Load reference genome in IGV
3. File → Load from File → select VCF
4. File → Load from File → select BAM

### Parse CSV Results in Python

```python
import pandas as pd

# Load all variants
df = pd.read_csv('results/results/all_variants.csv')

# Filter for high-impact variants
high_impact = df[df['impact'] == 'HIGH']

# Group by patient
patient_counts = df.groupby('patient_id')['pos'].count()
```
